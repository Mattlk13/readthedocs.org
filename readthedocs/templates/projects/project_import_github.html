{% extends "base.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Import a Remote Repository" %}{% endblock %}

{% block extra_links %}
  <link rel="stylesheet" type="text/css" href="{% static "projects/css/import.css" %}" />
{% endblock %}

{% block extra_scripts %}
  <script type="text/javascript" src="{% static "vendor/knockout.js" %}"></script>
  <script type="text/javascript" src="{% static "core/js/projectimport.js" %}"></script>
  <script type="text/javascript">
var import_views = require('core/projectimport');
$(document).ready(function() {
    var urls = {
            'api_sync_github_repositories': '{% url 'api_sync_github_repositories' %}',
            'api_sync_bitbucket_repositories': '{% url 'api_sync_bitbucket_repositories' %}',
            'oauthorganization-list': '{% url 'oauthorganization-list' %}',
            'oauthrepository-list': '{% url 'oauthrepository-list' %}',
            'projects_import': '{% url 'projects_import' %}'
        },
        instance = {}, {# projects_json|safe, #}
        view = import_views.ProjectImportView.init(
            $('body').get(0),
            instance,
            urls
        );
});
  </script>
{% endblock %}


{% block content %}
  {% if github_connected %}

    <ul
        class="notifications"
        style="display: none;"
        data-bind="visible: error">
      <li
          class="notification notification-40"
          data-bind="with: error">

        <span data-bind="visible: message">
          {% trans "There was an error with your request:" %}
          <span data-bind="text: message"></span>
        </span>

      </li>
    </ul>

    {% block main_content %}
      <div class="col-major project-import-remote">

        {% url 'api_sync_github_repositories' as sync_url %}
        <button
            data-bind="click: function() { sync_projects('{{ sync_url }}') }"
            class="remote-sync">
          <span>{% trans "Refresh your accounts" %}</span>
        </button>

        <!--
        <li class="notification notification-20"
            data-bind="visible: is_syncing",
            style="display: none;">
          {% blocktrans %}Syncing ...{% endblocktrans %}
          </li>
        -->

        <h1>{% trans "Import a Remote Repository" %}</h1>

        <div class="module repository-list">
          <div class="module-wrapper">
            <div class="module-list">
              <div class="module-list-wrapper">

                <ul data-bind="foreach: projects" class="remote-repos">
                  <li class="module-item remote-repo">

                    <img
                        data-bind="attr: {src: avatar_url}"
                        height="24"
                        class="remote-repo-avatar" />

                    <div class="remote-repo-info">
                      <a
                          data-bind="attr: {href: html_url}, text: full_name"
                          class="remote-repo-name">
                      </a>
                      <span
                          data-bind="text: ssh_url"
                          class="remote-repo-url">
                      </span>
                    </div>

                    <ul class="module-item-menu remote-repo-menu">
                      <button
                          data-bind="click: import_repo"
                          class="remote-repo-import">
                        <span>+</span>
                      </button>
                    </ul>

                  </li>
                </ul>

              </div>
            </div>
          </div>
        </div>

        <div class="pagination">
          <span data-bind="visible: !page_previous()" class="disabled prev">
            ‹‹ {% trans "previous" %}
          </span>
          <a
              href="#"
              data-bind="visible: page_previous, click: previous_page"
              class="prev">
            ‹‹ {% trans "previous" %}
          </a>

          <span data-bind="visible: !page_next()" class="disabled next">
            {% trans "next" %} ››
          </span>
          <a
              href="#"
              data-bind="visible: page_next, click: next_page"
              class="next">
            {% trans "next" %} ››
          </a>
        </div>

      </div>
    {% endblock main_content %}

    {% block sidebar_content %}
      <div class="col-minor import-remote-sidebar">
        <h3>{% trans "Remote Organizations" %}</h3>

        <ul data-bind="foreach: organizations" class="remote-orgs">
          <li
              class="remote-org"
              data-bind="css: {'remote-org-hidden': filtered()}, click: function () { $root.set_filter_org(id()); }">
            <img data-bind="attr: {src: avatar_url}" class="remote-org-avatar" />
            <span data-bind="text: display_name" class="remote-org-name"></span>
          </li>
        </ul>
      </div>
    {% endblock %}

  {% else %}

    {% block empty %}
      {% url 'socialaccount_connections' as social_url %}
      {% blocktrans %}
        You don't have any GitHub repositories connected.
        Go to your <a href="{{ social_url }}">Social Accounts</a> to set one up.
      {% endblocktrans %}
    {% endblock empty %}

  {% endif %}
{% endblock %}
